@using BazaarCompanionWeb.Utilities
@{
    // Bid Calculations (was Buy)
    var bidPrice = Product.BidUnitPrice;
    var bidDiff = BidAverage > 0 ? (bidPrice - BidAverage) / BidAverage : 0;
    var bidSign = bidDiff > 0 ? "+" : "";
    var bidColor = bidDiff >= 0 ? "text-emerald-400" : "text-rose-400";

    // Ask Calculations (was Sell)
    var askPrice = Product.AskUnitPrice;
    var askDiff = AskAverage > 0 ? (askPrice - AskAverage) / AskAverage : 0;
    var askSign = askDiff > 0 ? "+" : "";
    var askColor = askDiff >= 0 ? "text-emerald-400" : "text-rose-400";

    var bestAskSize = Product.AskBook?.FirstOrDefault()?.Amount ?? 0;
    var bestBidSize = Product.BidBook?.FirstOrDefault()?.Amount ?? 0;
    var spreadPercent = Product.OrderMetaSpread / bidPrice;
}

<div class="grid grid-cols-1 md:grid-cols-12 gap-4">

    <!-- 1. BID CARD (Left) -->
    <div
        class="md:col-span-5 relative group overflow-hidden rounded-2xl border border-emerald-500/30 bg-gradient-to-br from-emerald-900/20 to-slate-900/50 p-5 shadow-lg backdrop-blur-sm transition-all hover:border-emerald-500/50">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-xs font-bold uppercase tracking-widest text-emerald-500 mb-1">Bid Price</p>
                <div class="flex items-baseline gap-2">
                    <div class="text-3xl font-black tracking-tight text-emerald-400" title="@Product.BidUnitPrice.ToString("N2")">
                        @Product.BidUnitPrice.ToCompactString()
                    </div>
                    <div class="text-sm font-mono text-emerald-500/60">
                        × @bestBidSize.ToString("N0")
                    </div>
                </div>
            </div>
            <!-- Icon/indicator -->
            <div class="p-2 rounded-lg bg-emerald-500/10 text-emerald-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                </svg>
            </div>
        </div>
        <!-- Historical Context -->
        <div class="mt-4 flex items-center justify-between text-xs font-medium">
            <span class="text-emerald-600/80">Avg: @BidAverage.ToString("N2")</span>
            <span class="@bidColor bg-slate-950/30 px-2 py-0.5 rounded-md border border-slate-700/50">
                @bidSign@bidDiff.ToString("P2")
            </span>
        </div>
    </div>

    <!-- 2. SPREAD CARD (The Bridge) -->
    <div
        class="md:col-span-2 flex flex-col justify-center items-center rounded-2xl border border-slate-700/50 bg-slate-800/40 p-4 shadow-xl text-center backdrop-blur-md relative">
        <!-- Connecting Lines for 'Bridge' feel -->
        <div class="absolute -left-4 top-1/2 w-4 h-px bg-slate-700/50 hidden md:block"></div>
        <div class="absolute -right-4 top-1/2 w-4 h-px bg-slate-700/50 hidden md:block"></div>

        <p class="text-[10px] uppercase text-slate-500 font-bold tracking-widest mb-1">Spread</p>
        <div class="text-xl font-black text-white tracking-tighter" title="@Product.OrderMetaSpread.ToString("N2")">
            @Product.OrderMetaSpread.ToCompactString()
        </div>
        <!-- Margin Badge -->
        <span class="mt-1 inline-flex items-center rounded-full bg-slate-700/50 px-2 py-0.5 text-[10px] font-bold text-slate-300 border border-slate-600/30">
            @(spreadPercent.ToCompactString(true))
        </span>
    </div>

    <!-- 3. ASK CARD (Right) -->
    <div
        class="md:col-span-5 relative group overflow-hidden rounded-2xl border border-rose-500/30 bg-gradient-to-br from-rose-900/20 to-slate-900/50 p-5 shadow-lg backdrop-blur-sm transition-all hover:border-rose-500/50">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-xs font-bold uppercase tracking-widest text-rose-500 mb-1">Ask Price</p>
                <div class="flex items-baseline gap-2">
                    <div class="text-3xl font-black tracking-tight text-rose-400" title="@Product.AskUnitPrice.ToString("N2")">
                        @Product.AskUnitPrice.ToCompactString()
                    </div>
                    <div class="text-sm font-mono text-rose-500/60">
                        × @bestAskSize.ToString("N0")
                    </div>
                </div>
            </div>
            <div class="p-2 rounded-lg bg-rose-500/10 text-rose-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"/>
                </svg>
            </div>
        </div>
        <div class="mt-4 flex items-center justify-between text-xs font-medium">
            <span class="text-rose-600/80">Avg: @AskAverage.ToString("N2")</span>
            <span class="@askColor bg-slate-950/30 px-2 py-0.5 rounded-md border border-slate-700/50">
                @askSign@askDiff.ToString("P2")
            </span>
        </div>
    </div>

</div>
